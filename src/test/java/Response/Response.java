package Response;

import com.google.errorprone.annotations.Var;
import org.junit.Assert;
import org.junit.Test;
import org.openqa.selenium.By;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.chrome.ChromeDriver;
import org.openqa.selenium.support.ui.ExpectedConditions;
import org.openqa.selenium.support.ui.Select;
import org.openqa.selenium.support.ui.WebDriverWait;

import java.text.DateFormat;
import java.text.SimpleDateFormat;
import java.util.Calendar;
import java.util.Date;
import java.util.NoSuchElementException;
import java.util.concurrent.TimeUnit;


public class Response {

    @Test
    public void Response() throws InterruptedException {
        WebDriver driver;
        WebDriverWait wait;
        System.setProperty("webdriver.chrome.driver", "C:/Program Files/chromedriver/chromedriver.exe");
        driver = new ChromeDriver();
        wait = new WebDriverWait(driver, 30);
        driver.manage().window().maximize();
        driver.get("http://sugarcrm13.open.ru/sugarcrm");
        driver.findElement(By.xpath("//*[@id='user_name']")).sendKeys("open.ru\\ponomarev_mv");
        driver.findElement(By.xpath("//*[@id='user_password']")).sendKeys("Ekfcphk_46");
        driver.findElement(By.xpath("//*[@id='login_button']")).click();
        wait.until(ExpectedConditions.presenceOfElementLocated(By.xpath("//*[@id='grouptab_9']")));
        driver.findElement(By.xpath("//*[@id='grouptab_9']")).click();
        wait.until(ExpectedConditions.presenceOfElementLocated(By.xpath("//*[@id='moduleTab_9_Treatments']")));
        driver.findElement(By.xpath("//*[@id='moduleTab_9_Treatments']")).click();
        wait.until(ExpectedConditions.presenceOfElementLocated(By.xpath("//*[@id='ul_shortcuts']/li[2]/a")));
        driver.findElement(By.xpath("//*[@id='ul_shortcuts']/li[2]/a")).click();
        wait.until(ExpectedConditions.presenceOfElementLocated(By.xpath("//*[@id='search_form']/input[7]")));
        driver.findElement(By.xpath("//*[@id='search_form']/input[7]")).click();
        wait.until(ExpectedConditions.presenceOfElementLocated(By.xpath("//*[@id='tab_link_Treatments|advanced_search']")));
        driver.findElement(By.xpath("//*[@id='tab_link_Treatments|advanced_search']")).click();
        wait.until(ExpectedConditions.presenceOfElementLocated(By.xpath("//*[@id='start_date_advanced']")));
      //  driver.findElement(By.xpath("//*/input[@id='start_date_advanced']")).sendKeys("01.04.2018");
        WebElement selectElem = driver.findElement(By.xpath("//*[@name='status_advanced[]']"));
        Select select = new Select(selectElem);
        select.selectByValue("001");
        driver.findElement(By.xpath("//*[@id='search_form_submit']")).click();
        wait.until(ExpectedConditions.presenceOfElementLocated(By.xpath("//*[@id='MassUpdate']/table[1]/tbody/tr[3]/td[3]/a")));
        driver.findElement(By.xpath("//*[@id='MassUpdate']/table[1]/tbody/tr[3]/td[3]/a")).click();
        wait.until(ExpectedConditions.presenceOfElementLocated(By.xpath("//*[@name='GetTreatmentsActivities_create_button']")));
        driver.findElement(By.xpath("//*[@name='GetTreatmentsActivities_create_button']")).click();
        wait.until(ExpectedConditions.presenceOfElementLocated(By.xpath("//*[@id='TreatmentsActivities_subpanel_save_button']")));
        driver.findElement(By.xpath("//*/input[@id='priority']")).clear();
        driver.findElement(By.xpath("//*/input[@id='priority']")).sendKeys("111791");
        driver.findElement(By.xpath("//*[@id='TreatmentsActivities_subpanel_save_button']")).click();
        wait.until(ExpectedConditions.presenceOfElementLocated(By.xpath("//*[text()=111791]")));
        driver.findElement(By.xpath("//*[@id='list_subpanel_treatmentsactivities']/table/tbody/tr[3]/td[1]/span")).click();
        wait.until(ExpectedConditions.presenceOfElementLocated(By.xpath("//*[@id='_value']/button[3]")));
        driver.findElement(By.xpath("//*[@id='_value']/button[3]")).click();
        wait.until(ExpectedConditions.presenceOfElementLocated(By.xpath("//*[@id='step1']/form/input[2]")));
        WebElement selectElem2 = driver.findElement(By.xpath("//*[@id='rejections_reason']"));
        Select select2 = new Select(selectElem2);
        select2.selectByValue("c3bb70c9-b0a5-11e6-8559-005056ba58b3");
        driver.findElement(By.xpath("//*[@id='step1']/form/input[2]")).click();
        wait.until(ExpectedConditions.presenceOfElementLocated(By.xpath("//*[@id='theme']")));
        WebElement selectElem3 = driver.findElement(By.xpath("//*[@id='theme']"));
        Select select3 = new Select(selectElem3);
        select3.selectByValue("1");
        WebElement selectElem4 = driver.findElement(By.xpath("//*[@id='result_communication']"));
        Thread.sleep(5000);
        Select select4 = new Select(selectElem4);
        select4.selectByValue("1a761afc-a14b-a245-993a-59b0f52b4ae0");
        driver.findElement(By.xpath("//*[@id='step5']/form/input[3]")).click();
        wait.until(ExpectedConditions.presenceOfElementLocated(By.xpath("//*[@id='status_value']")));
        Assert.assertEquals("No Items", driver.findElement(By.xpath("//*[@id='status_value']")).getText(), "Открыта");
        WebElement Elem1 = driver.findElement(By.xpath("//*[@id='status_value']"));
        System.out.println(Elem1.getText());

     /*   driver.manage().timeouts().implicitlyWait(5, TimeUnit.SECONDS);
        try {

            WebElement element = driver.findElement(By.xpath("//*[@id='_value']/button[@value='101']"));

        } catch (NoSuchElementException e) {

// Element wasn't found. Do something here

        }*/

        Assert.assertEquals("No Items", driver.findElement(By.xpath("//*[@id='_value']/button[@value='101']")).getText(),"Согласие");
        WebElement Elem2 = driver.findElement(By.xpath("//*[@id='_value']/button[@value='101']"));
        System.out.println(Elem2.getText());
        Assert.assertEquals("No Items", driver.findElement(By.xpath("//*[@id='_value']/button[@value='102']")).getText(),"Перенос срока");
        WebElement Elem3 = driver.findElement(By.xpath("//*[@id='_value']/button[@value='102']"));
        System.out.println(Elem3.getText());
        Assert.assertEquals("No Items", driver.findElement(By.xpath("//*[@id='_value']/button[@value='103']")).getText(),"Отказ");
        WebElement Elem4 = driver.findElement(By.xpath("//*[@id='_value']/button[@value='103']"));
        System.out.println(Elem4.getText());
        Assert.assertEquals("No Items", driver.findElement(By.xpath("//*[@id='_value']/button[@value='104']")).getText(),"Не дозвонился");
        WebElement Elem5 = driver.findElement(By.xpath("//*[@id='_value']/button[@value='104']"));
        System.out.println(Elem5.getText());
        driver.findElement(By.xpath("//*[@id='_value']/button[2]")).click();
        wait.until(ExpectedConditions.presenceOfElementLocated(By.xpath("//*[@id='current_date_input']")));
        Calendar cal = Calendar.getInstance();
        cal.add(Calendar.DATE, 1);
        SimpleDateFormat formatForDateNow  = new SimpleDateFormat ("dd.MM.yyyy");
        driver.findElement(By.xpath("//*[@id='working_date_input']")).sendKeys(formatForDateNow.format(cal.getTime()));
        WebElement selectElems4 = driver.findElement(By.xpath("//*[@id='transfertime_reject']"));
        Select selects4 = new Select(selectElems4);
        selects4.selectByValue("2ae0ea04-6bc4-3227-e492-58c69de74d09");
        driver.findElement(By.xpath("//*[@id='step1']/form/input[1]")).click();
        wait.until(ExpectedConditions.presenceOfElementLocated(By.xpath("//*[@id='theme']")));
        WebElement selectElem5= driver.findElement(By.xpath("//*[@id='theme']"));
        Select select5 = new Select(selectElem5);
        select5.selectByValue("1");
        WebElement selectElem6 = driver.findElement(By.xpath("//*[@id='result_communication']"));
        Thread.sleep(5000);
        Select select6 = new Select(selectElem6);
        select6.selectByValue("1a761afc-a14b-a245-993a-59b0f52b4ae0");
        driver.findElement(By.xpath("//*[@id='step2']/form/input[3]")).click();
        Thread.sleep(5000);
        wait.until(ExpectedConditions.presenceOfElementLocated(By.xpath("//*[@id='step3']/form/input[2]")));
        driver.findElement(By.xpath("//*[@id='step3']/form/input[2]")).click();
        Thread.sleep(5000);
        Assert.assertEquals("No Items", driver.findElement(By.xpath("//*[@id='status_value']")).getText(),"Выполнена");
        driver.findElements(By.xpath("//*[@id='_value']/button[@value='101']")).isEmpty();
        driver.findElements(By.xpath("//*[@id='_value']/button[@value='102']")).isEmpty();
        driver.findElements(By.xpath("//*[@id='_value']/button[@value='103']")).isEmpty();
        driver.findElements(By.xpath("//*[@id='_value']/button[@value='104']")).isEmpty();

        //len(driver.findElements(By.xpath("//*[@id='_value']/button[@value='101']")).size()==0);

    }
}
